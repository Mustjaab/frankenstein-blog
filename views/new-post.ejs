<!-- new-post.ejs: editor used for drafting new posts, editing drafts, and editing published posts -->
<h1><%= (post && post.id) ? 'Edit Post' : (draft && draft.id) ? 'Edit Draft' : 'New Post' %></h1>

<form action="/save-post" method="post">
  <!-- If editing a published post, post.id will be present -->
  <% if (post && post.id) { %>
    <input type="hidden" name="postId" value="<%= post.id %>">
  <% } %>

  <!-- If editing a draft, draft.id -->
  <% if (draft && draft.id) { %>
    <input type="hidden" name="draftId" value="<%= draft.id %>">
  <% } %>

  <label>Title</label>
  <input name="title" value="<%= (draft && draft.title) ? draft.title : (post && post.title) ? post.title : '' %>" required>

  <label>Excerpt</label>
  <input name="excerpt" value="<%= (draft && draft.excerpt) ? draft.excerpt : (post && post.excerpt) ? post.excerpt : '' %>">

  <label>Author</label>
  <input name="author" value="<%= (draft && draft.author) ? draft.author : (post && post.author) ? post.author : 'Mustjaab' %>">

  <label>Tags (comma separated)</label>
  <input name="tags" value="<%= (draft && draft.tags) ? draft.tags.join(', ') : (post && post.tags) ? post.tags.join(', ') : '' %>">

  <label>Content (Markdown)</label>
  <textarea name="content" rows="15"><%= (draft && draft.content) ? draft.content : (post && post.rawContent) ? post.rawContent : (post && post.content) ? post.content : '' %></textarea>

  <button type="submit">Publish</button>
</form>

<hr>

<form action="/save-draft" method="post">
  <% if (draft && draft.id) { %>
    <input type="hidden" name="draftId" value="<%= draft.id %>">
  <% } %>

  <!-- Duplicate inputs required by save-draft -->
  <input name="title" type="hidden" value="<%= (draft && draft.title) ? draft.title : (post && post.title) ? post.title : '' %>">
  <input name="excerpt" type="hidden" value="<%= (draft && draft.excerpt) ? draft.excerpt : (post && post.excerpt) ? post.excerpt : '' %>">
  <input name="author" type="hidden" value="<%= (draft && draft.author) ? draft.author : (post && post.author) ? post.author : 'Mustjaab' %>">
  <input name="tags" type="hidden" value="<%= (draft && draft.tags) ? draft.tags.join(', ') : (post && post.tags) ? post.tags.join(', ') : '' %>">
  <textarea name="content" style="display:none;"><%= (draft && draft.content) ? draft.content : (post && post.rawContent) ? post.rawContent : (post && post.content) ? post.content : '' %></textarea>

  <button type="submit">Save as Draft</button>
</form>